---
title: 《Vue.js 设计与实现》：第 13 章_异步组件与函数式组件
tags:
  - 读书
  - Vue
  - Vue3
  - 问题
---

# 问题积累

> Vue2 中，相比于有状态组件来说，函数式组件具有明显的性能优势

问题：Vue2 中如何使用函数式组件？

问题：为什么 Vue2 中使用函数式组件具有明显的性能优势?

问题：Vue3 中做了哪些优化，让函数式组件与有状态组件性能接近？

# 异步组件

异步组件就是以异步的方式加载并渲染一个组件。这在代码分割、服务端下发组件等场景中尤为重要。

---

理解：

**代码分割：** 就是类似 router 那样的动态加载页面，只有真正访问到对应的 router 的时候，才会去加载对应页面的内容。利用这个特性，可以对某些用到 tab 切换的地方进行优化。只有真正访问对应 tab 的时候，才会去加载相应的组件。

异步组件，只有真正需要异步组件的时候，才会真正去执行对这个组件的代码，然后执行挂载与渲染操作。

**服务端下发组件：** 应当就是根据服务端返回的某些参数控制某些组件是否展示。比如权限控制。

## 异步组件的核心逻辑

> 从根本上来说，异步组件的实现不需要任何框架层面的支持，用户完全可以自行实现。

下面的代码是同步组件的挂载方式

```javascript
import App from "App.vue"
createApp.mount("#app");
```

异步渲染：

```javascript
const loader = () => import("App.vue");
loader().then(App => createApp(App).mount("#app"))
```

上面代码体现的只是实现异步组件的核心原理，一个完善的异步组件还需要考虑一下内容：

- 如果组件加载失败或加载超时，是否要渲染 Error 组件
- 组件在加载时是否要展示占位的内容？例如渲染一个 Loading 组件
- 组件加载的速度不定，是否需要设置一个延迟展示的 Loading 组件的时间？如果组件在 200ms 内没有加载成功才展示 Loading 组件，这样可以避免由组件加载过快导致的闪烁
- 组件加载失败后，是否需要重试？

